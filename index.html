<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>33min Production Tracker</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Spline+Sans:wght@300;400;500;600;700&family=Material+Icons&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="experiments/ui-v2/redesign.css">
    <style>
        /* Inline overrides if needed */
    </style>
</head>

<body>
    <div class="app-shell">
        <!-- Top Navigation Bar -->
        <header class="topbar">
            <div class="topbar-brand">
                <div class="brand-logo">33</div>
                <div class="brand-text">
                    <h1>Production Tracker</h1>
                    <span>VFX CONSOLE V2.4</span>
                </div>
            </div>

            <nav class="topbar-nav">
                <button class="nav-btn active" onclick="setAppView('home')" title="Startseite">
                    <span class="material-icons">home</span>
                </button>
                <button class="nav-btn" onclick="openHelpModal()" title="Hilfe">
                    <span class="material-icons">help_outline</span>
                </button>
                <button class="nav-btn" onclick="window.location.href='experiments/ui-v2/planner.html'"
                    title="Map Planner">
                    <span class="material-icons">map</span>
                </button>
                <button class="nav-btn" onclick="window.location.href='experiments/ui-v2/aim-trainer.html'"
                    title="Aim Trainer">
                    <span class="material-icons">crisis_alert</span>
                </button>
                <button class="nav-btn" id="cloudBtn" title="Cloud">
                    <span class="material-icons">cloud</span>
                </button>
            </nav>

            <div class="topbar-actions">
                <button class="nav-btn" title="Benachrichtigungen">
                    <span class="material-icons">notifications</span>
                </button>
                <div class="nav-btn" id="loginBtn" title="Profil" role="button" tabindex="0">
                    <span class="material-icons">account_circle</span>
                </div>
            </div>
        </header>

        <!-- Stats Bar -->
        <div class="stats-bar">
            <div class="stat-card">
                <div class="stat-icon red">
                    <span class="material-icons">hourglass_empty</span>
                </div>
                <div>
                    <div class="stat-value" id="statPending">--</div>
                    <div class="stat-label">Ausstehende Exporte</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon purple">
                    <span class="material-icons">movie_filter</span>
                </div>
                <div>
                    <div class="stat-value" id="statTotal">--</div>
                    <div class="stat-label">Alle VFX Shots</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon green">
                    <span class="material-icons">groups</span>
                </div>
                <div>
                    <div class="stat-value" id="statActive">--</div>
                    <div class="stat-label">Team Aktiv</div>
                </div>
            </div>
        </div>

        <!-- Content Area -->
        <div class="content-area">
            <!-- Composer Sidebar -->
            <aside class="composer-sidebar" id="composerSidebar">
                <section class="composer-panel">
                    <div class="panel-header">
                        <div>
                            <div class="panel-label">COMPOSER</div>
                            <div class="panel-title">Neuer Eintrag</div>
                        </div>
                        <div class="panel-actions">
                            <label class="switch" title="Werte nach Speichern behalten">
                                <input type="checkbox" id="keepValuesToggle">
                                <span>Behalten</span>
                            </label>
                            <button class="icon-btn" id="globalFieldsToggle" onclick="toggleGlobalFields()"
                                title="Optionale Felder">
                                <span class="material-icons">tune</span>
                            </button>
                        </div>
                    </div>

                    <div class="field-grid">
                        <div class="field">
                            <label>Show</label>
                            <div class="input-wrap">
                                <span class="material-icons">movie</span>
                                <select id="qShow">
                                    <option value="WCC">WCC</option>
                                    <option value="TR3">TR3</option>
                                </select>
                            </div>
                        </div>

                        <div class="field">
                            <label>Shot ID / Folge</label>
                            <div class="input-wrap">
                                <span class="material-icons">tag</span>
                                <input type="text" id="qSequence" placeholder="z.B. EP01">
                            </div>
                        </div>

                        <div class="field">
                            <label>Typ</label>
                            <div class="input-wrap">
                                <span class="material-icons">category</span>
                                <select id="typeSelect" onchange="selectType(this.value)">
                                    <option value="" selected disabled>Wählen...</option>
                                    <option value="temperatur">Temperatur</option>
                                    <option value="zeit">Zeit</option>
                                    <option value="geld">Geld</option>
                                    <option value="uebersicht">Übersicht</option>
                                    <option value="textbox">TextBox</option>
                                    <option value="todo">To-Do</option>
                                    <option value="ticket">Ticket</option>
                                    <option value="samsung">Samsung</option>
                                </select>
                            </div>
                        </div>

                        <!-- Date hidden but required for logic -->
                        <input type="hidden" id="autoDate">
                    </div>

                    <form id="quickForm" style="display: none; margin-top: 18px;">
                        <input type="hidden" id="qType">

                        <div class="quick-row">
                            <div class="field" id="personFieldGroup">
                                <label>Artist</label>
                                <div class="input-wrap">
                                    <span class="material-icons">person</span>
                                    <select id="qPerson" required>
                                        <option value="">Wählen...</option>
                                        <option value="Jerry">Jerry</option>
                                        <option value="Marc">Marc</option>
                                        <option value="Kodiak">Kodiak</option>
                                        <option value="Taube">Taube</option>
                                        <option value="Käthe">Käthe</option>
                                    </select>
                                </div>
                            </div>

                            <div class="field" id="dynamicField">
                                <label id="dynamicLabel">Wert</label>
                                <div class="input-wrap">
                                    <span class="material-icons" id="dynamicIcon">edit</span>
                                    <input type="text" id="qValue" placeholder="Eingabe...">
                                </div>
                            </div>
                        </div>

                        <details id="notesPanel">
                            <summary>Details &amp; To-Dos</summary>
                            <div id="extraFields"></div>
                        </details>

                        <div class="global-fields" id="globalFields">
                            <div class="field">
                                <label>Schnitt TS</label>
                                <div class="input-wrap">
                                    <span class="material-icons">schedule</span>
                                    <input type="text" id="qTimestamp" placeholder="00:00:00">
                                </div>
                            </div>
                            <div class="field">
                                <label>Cutter Info</label>
                                <div class="input-wrap">
                                    <span class="material-icons">info</span>
                                    <input type="text" id="qCutterInfo" placeholder="Notiz...">
                                </div>
                            </div>
                        </div>

                        <div class="status-selector">
                            <input type="hidden" id="qStatus" value="none">
                            <button type="button" class="status-chip status-draft" data-status-select="draft">In
                                Progress</button>
                            <button type="button" class="status-chip status-ready"
                                data-status-select="ready">Done</button>
                            <button type="button" class="status-chip status-none active" data-status-select="none">Kein
                                Status</button>
                        </div>

                        <button type="submit" class="btn btn-primary primary-action">
                            <span class="material-icons">add_circle</span>
                            Entry erstellen
                        </button>
                    </form>

                    <p class="helper-text" id="composerHint"
                        style="margin-top: auto; padding-top: 20px; text-align: center;">
                        Wähle einen Typ um zu starten.
                    </p>
                </section>
            </aside>

            <!-- Console Panel -->
            <main class="console-main">
                <section class="console-panel" id="entriesPanel">
                    <div class="console-header">
                        <button class="composer-toggle-btn"
                            onclick="document.getElementById('composerSidebar').classList.toggle('collapsed')"
                            title="Sidebar umschalten">
                            <span class="material-icons">vertical_split</span>
                        </button>

                        <div class="panel-title-wrap" style="margin-right: auto;">
                            <div class="console-title">Konsole</div>
                            <div class="chip-row">
                                <button class="chip active" data-filter="all">Alle Aktiv</button>
                                <button class="chip" data-filter="show" data-label="WCC Only">WCC Only</button>
                                <button class="chip" data-filter="show" data-label="TR3 Only">TR3 Only</button>
                            </div>
                        </div>

                        <div class="console-actions" id="consoleActions" style="display: none;">
                            <button class="btn btn-danger btn-sm" id="deleteSelectedBtn"
                                onclick="deleteSelectedEntries()">
                                <span class="material-icons">delete</span>
                            </button>
                            <button class="btn btn-danger btn-sm" id="deleteAllBtn" onclick="deleteAllEntries()">
                                <span class="material-icons">delete_sweep</span>
                            </button>
                        </div>

                        <div class="search-field">
                            <span class="material-icons">search</span>
                            <input type="text" id="consoleSearchInput" placeholder="Search shots...">
                            <span class="shortcut">⌘K</span>
                        </div>

                        <div class="topbar-actions">
                            <button class="icon-btn" onclick="showExportModal()" title="Export">
                                <span class="material-icons">download</span>
                            </button>
                            <button class="icon-btn" title="View Options">
                                <span class="material-icons">grid_view</span>
                            </button>
                        </div>
                    </div>

                    <div class="table-wrapper custom-scrollbar">
                        <table class="data-grid">
                            <thead>
                                <tr>
                                    <th style="width: 40px;">
                                        <input type="checkbox" id="selectAll">
                                    </th>
                                    <th class="sortable" data-sort="id" style="width: 60px;">ID</th>
                                    <th style="width: 60px;">Preview</th>
                                    <th class="sortable" data-sort="folge" style="width: 120px;">Shot ID</th>
                                    <th class="sortable" data-sort="textboxText">Description</th>
                                    <th class="sortable" data-sort="status" style="width: 140px;">Status</th>
                                    <th class="sortable" data-sort="teilnehmer" style="width: 140px;">Artist</th>
                                    <th style="width: 80px;">Ver</th>
                                    <th style="width: 100px;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="dataBody">
                                <!-- Filled by JS -->
                                <tr>
                                    <td colspan="9">
                                        <div class="empty-state">
                                            <span class="material-icons"
                                                style="font-size: 48px; opacity: 0.2;">hourglass_empty</span>
                                            <h3>Lade Daten...</h3>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="pagination-bar">
                        <div class="pagination-info" id="paginationInfo">Zeige 0 von 0 Einträgen</div>
                        <div class="pagination-controls" id="paginationControls">
                            <!-- Filled by JS -->
                        </div>
                        <!-- Hidden count for legacy JS compatibility -->
                        <span id="entryCount" style="display: none;">0</span>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Modals (Preserved) -->
    <div id="sheetsModal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="width: min(420px, 95vw);">
            <div class="panel-header" style="margin-bottom: 12px;">
                <div>
                    <div class="panel-label">Google Sheets</div>
                    <div class="panel-title">Sheets-Verbindung</div>
                </div>
                <button class="icon-btn close-btn" onclick="hideSheetsModal()">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div style="display: flex; flex-direction: column; gap: 16px;">
                <div id="authStatus"
                    style="padding: 12px; border-radius: 12px; background: rgba(255,255,255,0.04); display: flex; align-items: center; gap: 10px; font-size: 0.9em;">
                    <span class="material-icons" style="color: #ea4335;">error</span>
                    <span>Nicht verbunden</span>
                </div>

                <div class="field">
                    <label>Spreadsheet-ID</label>
                    <div class="input-wrap">
                        <span class="material-icons" style="font-size: 18px;">description</span>
                        <input type="text" id="spreadsheetIdInput" placeholder="ID aus der URL kopieren">
                    </div>
                    <p class="helper-text">Beispiel: https://docs.google.com/spreadsheets/d/SpreadsheetID/edit</p>
                </div>

                <div style="display: flex; gap: 10px;">
                    <button id="authBtn" class="btn" style="flex: 1; justify-content: center;"
                        onclick="handleAuthClick()">
                        <span class="material-icons">login</span> Anmelden
                    </button>
                    <button id="saveSheetsSettings" class="btn btn-primary" style="flex: 1; justify-content: center;"
                        onclick="saveSheetsSettings()">
                        <span class="material-icons">save</span> Speichern
                    </button>
                </div>

                <div id="sheetsActions"
                    style="display: none; flex-direction: column; gap: 10px; padding-top: 10px; border-top: 1px solid var(--border);">
                    <button class="export-opt-btn" onclick="pushToGoogleSheets()">
                        <span class="material-icons">cloud_upload</span>
                        <span>Daten jetzt hochladen</span>
                    </button>
                    <button class="export-opt-btn" onclick="pullFromGoogleSheets()">
                        <span class="material-icons">cloud_download</span>
                        <span>Daten aus Sheets laden</span>
                    </button>
                </div>
            </div>
        </div>
    </div>


    <div id="statusMenu" class="status-menu">
        <div class="status-menu-title">Status setzen</div>
        <div class="status-menu-grid">
            <button class="status-chip status-none" data-status="none" onclick="setStatusForEntry('none')">Kein
                Status</button>
            <button class="status-chip status-draft" data-status="draft"
                onclick="setStatusForEntry('draft')">Entwurf</button>
            <button class="status-chip status-ready" data-status="ready" onclick="setStatusForEntry('ready')">Export
                bereit</button>
            <button class="status-chip status-exported" data-status="exported"
                onclick="setStatusForEntry('exported')">Exportiert</button>
            <button class="status-chip status-edited" data-status="edited"
                onclick="setStatusForEntry('edited')">Bearbeitet</button>
            <button class="status-chip status-error" data-status="error"
                onclick="setStatusForEntry('error')">Fehler</button>
        </div>
    </div>

    <div id="previewModal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="width: min(720px, 95vw);">
            <div class="panel-header" style="margin-bottom: 12px;">
                <div>
                    <div class="panel-label">Vorschau</div>
                    <div class="panel-title" id="previewTitle">Bereich</div>
                </div>
                <button class="icon-btn close-btn" onclick="hidePreview()">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div style="display: grid; gap: 14px;">
                <div class="helper-text" id="previewHint">Dieser Bereich wird gerade eingerichtet.</div>
                <div class="preview-window preview-dim" id="previewBody"></div>
            </div>
        </div>
    </div>

    <div id="cloudModal" class="cloud-page" style="display: none;">
        <div class="cloud-page-header">
            <button class="cloud-back-btn" id="cloudCloseBtn" title="Zurück">
                <span class="material-icons" style="font-size: 20px;">arrow_back</span>
            </button>
            <div class="cloud-page-title-block">
                <h2><span class="material-icons">cloud</span> Cloud-Einträge</h2>
                <div class="cloud-subtitle">Alle Team-Einträge in Echtzeit · <span id="cloudRowCount">0</span> Einträge
                </div>
            </div>
            <div class="cloud-page-actions">
                <button class="icon-btn" id="cloudCloseBtn2" title="Schließen">
                    <span class="material-icons">close</span>
                </button>
            </div>
        </div>

        <div class="cloud-toolbar">
            <div class="cloud-filter-group">
                <label>Folge</label>
                <input type="text" class="cloud-filter-input" id="cloudFilterFolge" placeholder="z.B. EP01">
            </div>
            <div class="cloud-filter-group">
                <label>Status</label>
                <select class="cloud-filter-select" id="cloudFilterStatus">
                    <option value="">Alle</option>
                    <option value="draft">Entwurf</option>
                    <option value="ready">Export bereit</option>
                    <option value="done">Done</option>
                </select>
            </div>
            <div class="cloud-filter-group">
                <label>Sortierung</label>
                <select class="cloud-filter-select" id="cloudSort">
                    <option value="created_desc">Neueste zuerst</option>
                    <option value="created_asc">Älteste zuerst</option>
                    <option value="datum_desc">Datum (neu → alt)</option>
                    <option value="datum_asc">Datum (alt → neu)</option>
                </select>
            </div>
            <div class="cloud-export-group">
                <button class="cloud-export-btn" id="cloudExportTsv">TSV</button>
                <button class="cloud-export-btn" id="cloudExportCsv">CSV</button>
                <button class="cloud-export-btn" id="cloudExportJson">JSON</button>
            </div>
        </div>

        <div class="cloud-page-body">
            <table class="cloud-table">
                <thead>
                    <tr>
                        <th>User</th>
                        <th>Datum</th>
                        <th>Show</th>
                        <th>Folge</th>
                        <th>Typ</th>
                        <th>Teilnehmer</th>
                        <th>Farbe</th>
                        <th>Komposition</th>
                        <th>Temp</th>
                        <th>Zeit</th>
                        <th>Start</th>
                        <th>+/-</th>
                        <th>Aktuell</th>
                        <th>Stempel</th>
                        <th>Text</th>
                        <th>To-Do</th>
                        <th>Status</th>
                        <th>Schnitt</th>
                        <th>Cutter</th>
                        <th>Done</th>
                        <th>Aktionen</th>
                    </tr>
                </thead>
                <tbody id="cloudTableBody">
                    <tr>
                        <td colspan="21">
                            <div class="helper-text" id="cloudEmpty">Keine Cloud-Daten.</div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="cloud-page-footer">
            <span>Cloud-Synchronisation aktiv</span>
            <span id="cloudFooterCount"></span>
        </div>
    </div>

    <div id="authModal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="width: min(420px, 95vw);">
            <div class="panel-header" style="margin-bottom: 12px;">
                <div>
                    <div class="panel-label">Account</div>
                    <div class="panel-title">Login</div>
                </div>
                <button class="icon-btn close-btn" id="authCloseBtn">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="auth-form">
                <div class="field">
                    <label>E-Mail</label>
                    <div class="input-wrap">
                        <span class="material-icons" style="font-size: 18px;">mail</span>
                        <input type="email" id="authEmail" placeholder="name@firma.de">
                    </div>
                </div>
                <div class="field">
                    <label>Passwort</label>
                    <div class="input-wrap">
                        <span class="material-icons" style="font-size: 18px;">lock</span>
                        <input type="password" id="authPassword" placeholder="Passwort">
                    </div>
                </div>
                <button class="btn btn-primary" id="authLoginBtn" style="margin-top: 12px;">
                    <span class="material-icons">login</span>
                    Login
                </button>
                <div class="auth-divider">oder</div>
                <button class="btn" id="authSignupBtn">
                    <span class="material-icons">person_add</span>
                    Registrieren
                </button>
            </div>
        </div>
    </div>

    <div id="profileModal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="width: min(420px, 95vw);">
            <div class="panel-header" style="margin-bottom: 12px;">
                <div>
                    <div class="panel-label">Dein Account</div>
                    <div class="panel-title">Profil</div>
                </div>
                <button class="icon-btn close-btn"
                    onclick="document.getElementById('profileModal').style.display='none'">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div style="display: flex; flex-direction: column; gap: 16px;">
                <div style="text-align: center; margin-bottom: 8px;">
                    <div id="profileAvatarContainer" onclick="openAvatarBuilder()"
                        style="width: 80px; height: 80px; border-radius: 50%; background: var(--bg-accent); border: 2px solid var(--border); display: inline-flex; align-items: center; justify-content: center; margin-bottom: 8px; cursor: pointer; position: relative; overflow: hidden; transition: transform 0.2s, box-shadow 0.2s;"
                        onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='var(--shadow-float)';"
                        onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none';">
                        <img id="profileAvatarImg" src="" alt="Avatar"
                            style="width: 100%; height: 100%; object-fit: cover; display: none;">
                        <span class="material-icons" id="profileAvatarPlaceholder"
                            style="font-size: 32px; color: var(--text-secondary);">person</span>
                        <div style="position: absolute; bottom: 0; left: 0; right: 0; background: rgba(0,0,0,0.5); padding: 2px; display: flex; justify-content: center; opacity: 0; transition: opacity 0.2s;"
                            class="avatar-hover-edit">
                            <span class="material-icons" style="font-size: 14px; color: white;">edit</span>
                        </div>
                    </div>

                    <div id="profileEmailDisplay" style="color: var(--text-secondary); font-size: 0.9em;"></div>
                </div>

                <div class="field">
                    <label>Dein Name (Kürzel)</label>
                    <div class="input-wrap">
                        <span class="material-icons" style="font-size: 18px;">badge</span>
                        <input type="text" id="profileDisplayName" placeholder="Dein Name">
                    </div>
                    <p class="helper-text">Dieser Name wird statt der E-Mail in der Cloud angezeigt.</p>
                </div>

                <button class="btn btn-primary" id="saveProfileBtn" style="justify-content: center;">
                    <span class="material-icons">save</span> Speichern
                </button>

                <div class="auth-divider" style="margin: 8px 0;"></div>

                <button class="btn btn-danger" id="authLogoutBtn" style="justify-content: center;">
                    <span class="material-icons">logout</span> Abmelden
                </button>
            </div>
        </div>
    </div>

    <div id="avatarBuilderModal" class="modal-overlay" style="display: none; z-index: 10001;">
        <div class="modal-content" style="width: min(900px, 95vw); max-width: 900px;">
            <div class="panel-header" style="margin-bottom: 12px;">
                <div>
                    <div class="panel-label">DiceBear Avatar</div>
                    <div class="panel-title">✨ Avatar erstellen</div>
                </div>
                <button class="icon-btn close-btn" onclick="closeAvatarCreator()">
                    <span class="material-icons">close</span>
                </button>
            </div>

            <p style="color: var(--text-secondary); margin-bottom: 20px; font-size: 0.9em;">Gestalte dein persönliches
                Profilbild</p>

            <div class="avatar-creator-layout">
                <!-- Vorschau Sektion -->
                <div class="avatar-preview-section">
                    <h3 style="color: var(--text); margin-bottom: 15px; font-size: 1rem; font-weight: 600;">Vorschau
                    </h3>
                    <div
                        style="width: 200px; height: 200px; margin: 0 auto 20px; border: 4px solid var(--primary); border-radius: 50%; overflow: hidden; background: white; box-shadow: var(--shadow-out);">
                        <img id="avatarPreview" src="" alt="Avatar Vorschau"
                            style="width: 100%; height: 100%; object-fit: cover;">
                    </div>
                    <button class="btn" style="width: 100%; justify-content: center; background: #2196F3; color: white;"
                        onclick="generateRandomAvatar()">
                        <span class="material-icons">casino</span>
                        Zufällig generieren
                    </button>
                </div>

                <!-- Optionen Sektion -->
                <div class="avatar-options-section">
                    <h3
                        style="color: var(--text); margin-bottom: 20px; font-size: 1rem; font-weight: 600; padding-bottom: 10px; border-bottom: 2px solid var(--primary);">
                        Anpassungen</h3>

                    <!-- Avatar Stil -->
                    <div class="field" style="margin-bottom: 20px;">
                        <label>Avatar-Stil</label>
                        <div class="input-wrap">
                            <span class="material-icons" style="font-size: 18px;">palette</span>
                            <select id="avatarStyle" onchange="updateAvatar()"
                                style="border: none; background: transparent; width: 100%; outline: none; color: var(--text);">
                                <option value="avataaars">Avataaars (Comic)</option>
                                <option value="bottts">Bottts (Roboter)</option>
                                <option value="personas">Personas</option>
                                <option value="lorelei">Lorelei</option>
                                <option value="notionists">Notionists</option>
                                <option value="adventurer">Adventurer</option>
                                <option value="big-smile">Big Smile</option>
                                <option value="fun-emoji">Fun Emoji</option>
                                <option value="thumbs">Thumbs</option>
                                <option value="initials">Initialen</option>
                                <option value="croodles">Croodles</option>
                            </select>
                        </div>
                    </div>

                    <!-- Seed Input -->
                    <div class="field" style="margin-bottom: 20px;">
                        <label>Name / Basis</label>
                        <div class="input-wrap">
                            <span class="material-icons" style="font-size: 18px;">fingerprint</span>
                            <input type="text" id="avatarSeed" placeholder="Dein Name" oninput="updateAvatar()">
                        </div>
                        <p class="helper-text" style="margin-top: 4px;">Gleicher Name = gleicher Avatar</p>
                    </div>

                    <!-- Hintergrundfarbe -->
                    <div style="margin-bottom: 25px;">
                        <label
                            style="display: block; color: var(--text); font-weight: 600; margin-bottom: 10px; font-size: 0.9rem;">Hintergrundfarbe</label>
                        <div id="colorGrid" class="avatar-color-grid">
                            <!-- Wird mit JavaScript gefüllt -->
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div style="display: flex; gap: 10px; margin-top: 30px;">
                        <button class="btn" style="flex: 1; justify-content: center;" onclick="closeAvatarCreator()">
                            Abbrechen
                        </button>
                        <button class="btn btn-primary" style="flex: 1; justify-content: center;"
                            onclick="saveAvatar()">
                            <span class="material-icons">check</span>
                            Speichern
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="helpModal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="width: min(680px, 95vw); max-height: 90vh; overflow-y: auto;">
            <div class="panel-header" style="margin-bottom: 12px;">
                <div>
                    <div class="panel-label">Anleitung</div>
                    <div class="panel-title">Hilfe &amp; Infos</div>
                </div>
                <button class="icon-btn close-btn" onclick="document.getElementById('helpModal').style.display='none'">
                    <span class="material-icons">close</span>
                </button>
            </div>

            <div id="helpCarouselContent" style="display: flex; flex-direction: column; gap: 20px;">
                <!-- Content filled by JS -->
            </div>

            <div style="display: flex; justify-content: center; gap: 8px; margin-top: 24px;" id="helpDots">
                <!-- Dots filled by JS -->
            </div>
            <div style="display: flex; justify-content: flex-end; margin-top: 12px;">
                <button class="btn" id="helpNextBtn" onclick="nextHelpPage()">Weiter <span class="material-icons"
                        style="font-size: 16px;">arrow_forward</span></button>
            </div>
        </div>
    </div>

    <div id="exportModal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="width: min(420px, 95vw);">
            <div class="panel-header" style="margin-bottom: 12px;">
                <div>
                    <div class="panel-label">Daten</div>
                    <div class="panel-title">Exportieren</div>
                </div>
                <button class="icon-btn close-btn" onclick="hideExportModal()">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div style="display: flex; flex-direction: column; gap: 10px;">
                <button class="export-opt-btn" onclick="handleExport('csv')">
                    <span class="material-icons">table_view</span>
                    <span>CSV (Excel)</span>
                </button>
                <button class="export-opt-btn" onclick="handleExport('tsv')">
                    <span class="material-icons">view_list</span>
                    <span>TSV (Tab-getrennt)</span>
                </button>
                <button class="export-opt-btn" onclick="handleExport('json')">
                    <span class="material-icons">data_object</span>
                    <span>JSON (Backup)</span>
                </button>
            </div>
        </div>
    </div>

    <div id="gameModal" class="modal-overlay" style="display: none; z-index: 10002;">
        <div class="modal-content"
            style="width: min(800px, 95vw); height: 500px; padding: 0; overflow: hidden; position: relative; background: #000;">
            <div class="panel-header" style="position: absolute; top: 16px; left: 16px; right: 16px; z-index: 10;">
                <div>
                    <div class="panel-label" style="color: rgba(255,255,255,0.7);">Easter Egg</div>
                    <div class="panel-title" style="color: white; text-shadow: 0 2px 4px rgba(0,0,0,0.5);">Dino Run
                    </div>
                </div>
                <button class="icon-btn close-btn" onclick="hideGameModal()"
                    style="background: rgba(0,0,0,0.5); color: white;">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div id="gameScore"
                style="position: absolute; top: 20px; right: 60px; font-family: monospace; font-size: 24px; color: white; z-index: 10;">
                00000</div>

            <div
                style="width: 100%; height: 100%; position: relative; overflow: hidden; background: linear-gradient(180deg, #87CEEB 0%, #E0F6FF 100%);">
                <!-- Ground -->
                <div style="position: absolute; bottom: 0; width: 100%; height: 20px; background: #654321;"></div>

                <!-- Dino -->
                <div id="dino" style="position: absolute; bottom: 10px; left: 50px; width: 44px; height: 47px;">
                    <img id="dinoImg" src="experiments/ui-v2/assets/dino/DinoRun1.png"
                        style="width: 100%; height: 100%; image-rendering: pixelated;">
                </div>

                <div id="gameObjective" style="position: absolute; inset: 0; pointer-events: none;"></div>

                <div id="gameOverScreen"
                    style="position: absolute; inset: 0; background: rgba(0,0,0,0.7); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 20;">
                    <h2 style="color: white; font-size: 32px; margin-bottom: 10px;">GAME OVER</h2>
                    <div id="finalScore" style="color: white; font-size: 20px; margin-bottom: 20px;">SCORE: 00000</div>
                    <button class="btn btn-primary" onclick="startGame()">Nochmal spielen (Space)</button>
                </div>
            </div>
        </div>
    </div>


    <div id="saveStatus" aria-live="polite"></div>

    <script src="experiments/ui-v2/help-system.js"></script>
    <script src="experiments/ui-v2/avatar-builder.js"></script>
    <script src="experiments/ui-v2/dist/app.js"></script>
    <script type="module" src="experiments/ui-v2/supabase-app.js"></script>
</body>

</html>